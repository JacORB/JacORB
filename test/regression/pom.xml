<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                             http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.jacorb</groupId>
        <artifactId>jacorb-parent</artifactId>
        <version>3.4-SNAPSHOT</version>
        <relativePath>../..</relativePath>
    </parent>

    <artifactId>jacorb-regression</artifactId>
    <packaging>jar</packaging>

    <name>JacORB Regression Tests</name>
    <description>JacORB Regression Tests</description>
    <url>http://www.jacorb.org</url>

    <dependencies>
        <dependency>
            <groupId>org.jacorb</groupId>
            <artifactId>jacorb</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>org.jacorb</groupId>
            <artifactId>jacorb-omgapi</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>org.jacorb</groupId>
            <artifactId>jacorb-idl-compiler</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>org.jacorb</groupId>
            <artifactId>jacorb-services</artifactId>
            <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>junit</groupId>
	    <artifactId>junit</artifactId>
        </dependency>
        <dependency>
            <groupId>easymock</groupId>
	    <artifactId>easymock</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-install-plugin</artifactId>
                <executions>
                    <execution>
                        <id>default-install</id>
                        <configuration>
                            <skip>true</skip>
                        </configuration>
                    </execution>
                </executions>
           </plugin>

            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>idlj-maven-plugin</artifactId>
                <version>1.2.1</version>
                <executions>

                    <execution>
                        <id>standard-compile</id>
                        <goals>
                            <goal>generate-test</goal>
                        </goals>
                        <configuration>
                            <sources>
                                <source>
                                    <includes>
                                        <include>*.idl</include>
                                    </includes>
                                    <excludes>
                                        <exclude>CallbackServer.idl</exclude>
                                        <exclude>TimingServer.idl</exclude>
                                        <exclude>antBugJac608.idl</exclude>
                                        <exclude>SyncScopeServer.idl</exclude>
                                        <exclude>_bugjac560.idl</exclude>
                                        <exclude>_bugjac801.idl</exclude>
                                        <exclude>ami_bug*.idl</exclude>
                                    </excludes>
                                    <additionalArguments>
                                        <additionalArgument>-generate_helper</additionalArgument>
                                        <additionalArgument>jacorb</additionalArgument>
                                    </additionalArguments>
                                </source>
                            </sources>
                        </configuration>
                    </execution>

                    <execution>
                        <id>ami-compile</id>
                        <goals>
                            <goal>generate-test</goal>
                        </goals>
                        <configuration>
                            <sources>
                                <source>
                                    <includes>
                                        <include>CallbackServer.idl</include>
                                        <include>TimingServer.idl</include>
                                        <include>SyncScopeServer.idl</include>
                                        <include>ami_bug*.idl</include>
                                    </includes>
                                    <additionalArguments>
                                        <additionalArgument>-ami_callback</additionalArgument>
                                    </additionalArguments>
                                </source>
                            </sources>
                        </configuration>
                    </execution>

                    <execution>
                        <id>bugjac560</id>
                        <goals>
                            <goal>generate-test</goal>
                        </goals>
                        <configuration>
                            <sources>
                                <source>
                                    <includes>
                                        <include>_bugjac560.idl</include>
                                    </includes>
                                    <additionalArguments>
                                        <additionalArgument>-i2jpackage</additionalArgument>
                                        <additionalArgument>Node:cerent.cms.idl.Node</additionalArgument>
                                        <additionalArgument>-ami_callback</additionalArgument>
                                    </additionalArguments>
                                </source>
                            </sources>
                        </configuration>
                    </execution>

                    <execution>
                        <id>bugjac801</id>
                        <goals>
                            <goal>generate-test</goal>
                        </goals>
                        <configuration>
                            <sources>
                                <source>
                                    <includes>
                                        <include>_bugjac801.idl</include>
                                    </includes>
                                    <additionalArguments>
                                        <additionalArgument>-genEnhanced</additionalArgument>
                                        <additionalArgument>-generate_helper</additionalArgument>
                                        <additionalArgument>jacorb</additionalArgument>
                                    </additionalArguments>
                                </source>
                            </sources>
                        </configuration>
                    </execution>

                    <execution>
                        <id>bugjac608</id>
                        <goals>
                            <goal>generate-test</goal>
                        </goals>
                        <configuration>
                            <sources>
                                <source>
                                    <includes>
                                        <include>antBugJac608.idl</include>
                                    </includes>
                                    <additionalArguments>
                                        <additionalArgument>-i2jpackage</additionalArgument>
                                        <additionalArgument>antBugJac608:org.jacorb.test.antBugJac608</additionalArgument>
                                        <additionalArgument>-sloppy_identifiers</additionalArgument>
                                        <additionalArgument>-generate_helper</additionalArgument>
                                        <additionalArgument>jacorb</additionalArgument>
                                    </additionalArguments>
                                </source>
                            </sources>
                        </configuration>
                    </execution>

                    <execution>
                        <id>echocorbaloc</id>
                        <goals>
                            <goal>generate-test</goal>
                        </goals>
                        <configuration>
                            <sourceDirectory>${basedir}/../listenendpoints/echo_corbaloc/idl</sourceDirectory>
                            <sources>
                                <source>
                                    <includes>
                                        <include>server.idl</include>
                                    </includes>
                                    <additionalArguments>
                                        <additionalArgument>-i2jpackage</additionalArgument>
                                        <additionalArgument>:org.jacorb</additionalArgument>
                                        <additionalArgument>-generate_helper</additionalArgument>
                                        <additionalArgument>jacorb</additionalArgument>
                                    </additionalArguments>
                                </source>
                            </sources>
                        </configuration>
                    </execution>

                </executions>
                <configuration>
                    <compiler>jacorb</compiler>
                    <includeDirs>
                        <includeDir>${basedir}/../../idl/omg</includeDir>
                        <includeDir>${basedir}/idl</includeDir>
                    </includeDirs>
                </configuration>
                <dependencies>
                    <dependency>
                        <groupId>org.jacorb</groupId>
                        <artifactId>jacorb-idl-compiler</artifactId>
                        <version>${project.version}</version>
                    </dependency>
                </dependencies>
            </plugin>

	    <plugin>
		<groupId>org.codehaus.mojo</groupId>
		<artifactId>build-helper-maven-plugin</artifactId>
		<executions>
		    <execution>
			<id>add-test-source</id>
			<phase>process-test-sources</phase>
			<goals>
			    <goal>add-test-source</goal>
			</goals>
			<configuration>
			    <sources>
				<source>${project.build.directory}/generated-test-sources/idl</source>
				<source>${basedir}/../listenendpoints/echo_corbaloc/src</source>
			    </sources>
			</configuration>
		    </execution>
		</executions>
	    </plugin>

            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>rmic-maven-plugin</artifactId>
                <version>1.2.1</version>
                <executions>
                    <execution>
                        <id>rmi compilation</id>
                        <goals>
                            <goal>test-rmic</goal>
                        </goals>
                        <phase>process-test-classes</phase>
                        <configuration>
                            <keep>true</keep>
                            <iiop>true</iiop>
                            <poa>true</poa>
                            <testOutputDirectory>${project.build.testOutputDirectory}</testOutputDirectory>
                            <sources>
                                <source>
                                    <includes>
                                        <include>org.jacorb.test.orb.rmi.RMITestImpl.class</include>
                                        <include>org.jacorb.test.bugs.bugjac149.RemoteIPingImpl.class</include>
                                    </includes>
                                </source>
                            </sources>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

	    <plugin>
                <groupId>org.apache.maven.plugins</groupId>
		<artifactId>maven-compiler-plugin</artifactId>
                <version>3.1</version>
                <configuration>
                    <testSource>1.6</testSource>
                    <testTarget>1.6</testTarget>
                    <debug>true</debug>
                    <showWarnings>true</showWarnings>
                    <showDeprecation>true</showDeprecation>
                    <compilerArgs>
                        <arg>-Xbootclasspath/p:${settings.localRepository}/org/jacorb/jacorb-omgapi/${project.version}/jacorb-omgapi-${project.version}.jar</arg>
                    </compilerArgs>
                </configuration>
		<executions>
		    <execution>
                        <id>default-testCompile</id>
		        <phase>test-compile</phase>
		        <goals>
		            <goal>testCompile</goal>
		        </goals>
                        <configuration>
                            <testExcludes>
                                <testExclude>**/RMITestServant.java</testExclude>
                            </testExcludes>
                        </configuration>
                    </execution>
		    <execution>
                        <id>rmi-compile</id>
			<phase>process-test-classes</phase>
			<goals>
			    <goal>testCompile</goal>
			</goals>
                        <configuration>
                            <testIncludes>
                                <testInclude>**/RMITestServant.java</testInclude>
                            </testIncludes>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>2.16</version>
                <configuration>
                    <systemPropertyVariables>
                        <!-- Default timeout for a server to start -->
                        <jacorb.test.timeout.server>60000</jacorb.test.timeout.server>
                    </systemPropertyVariables>
                </configuration>
                <executions>
                    <execution>
                        <id>default-test</id>
                        <phase>test</phase>
                        <goals>
                            <goal>test</goal>
                        </goals>
                        <configuration>
                            <forkCount>0.75C</forkCount>
                            <reuseForks>false</reuseForks>
                            <argLine>-Xbootclasspath/p:${settings.localRepository}/org/jacorb/jacorb-omgapi/${project.version}/jacorb-omgapi-${project.version}.jar -Djacorb.test.verbose=${jacorb.test.verbose}</argLine>
                        </configuration>
                    </execution>
                    <execution>
                        <id>ssl</id>
                        <phase>test</phase>
                        <goals>
                            <goal>test</goal>
                        </goals>
                        <configuration>
                            <forkCount>0.75C</forkCount>
                            <reuseForks>false</reuseForks>
                            <argLine>-Xbootclasspath/p:${settings.localRepository}/org/jacorb/jacorb-omgapi/${project.version}/jacorb-omgapi-${project.version}.jar -Djacorb.test.verbose=${jacorb.test.verbose} -Djacorb.test.ssl=true</argLine>
                            <reportsDirectory>${project.build.directory}/surefire-reports-ssl</reportsDirectory>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <!--
                 This generates a nice aggregate report. To make the HTML nicer run
                 mvn site
                 If the tests fail this plugin might not run. To generate the report then run
                 mvn -Dmaven.test.skip=true test site
            -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-report-plugin</artifactId>
                <version>2.16</version>
                <executions>
                    <execution>
                        <id>test-report</id>
                        <phase>test</phase>
                        <goals>
                            <goal>report-only</goal>
                        </goals>
                        <configuration>
                            <linkXRef>false</linkXRef>
                            <aggregate>true</aggregate>
                            <reportsDirectories>
                                <reportDirectory>${project.build.directory}/surefire-reports</reportDirectory>
                                <reportDirectory>${project.build.directory}/surefire-reports-ssl</reportDirectory>
                            </reportsDirectories>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

        </plugins>
    </build>
</project>
