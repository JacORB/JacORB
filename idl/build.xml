<?xml version="1.0"?>

<project name="main" default="all" basedir="..">

  <!-- ==================================================== -->
  <!--            JacORB idl build file                     -->
  <!-- $Id$ -->
  <!-- ==================================================== -->

   <target name="init" depends="javatest">
	<property name="name" value="omg_idl"/>
	<property name="dirs.base" value="${basedir}"/>
	<property name="classdir" value="${dirs.base}/classes"/>
	<property name="classpath" 
                  value="${java.class.path}:${dirs.base}/classes"/>
	<property name="src" value="${dirs.base}/src"/>
	<property name="lib" value="${dirs.base}/lib"/>
	<property name="include" value="${dirs.base}/idl"/>
	<property name="idlflags" 
                  value="-ir -I${basedir}/idl/omg -p org.omg -d ${src}/generated"/>
	<mkdir dir="${classdir}"/>
	<mkdir dir="${lib}"/>
	<available classname="java.util.Collection" property="java2.present"/>
	<filter token="path" value="basedir"/>
   </target>

   <!-- check for Java 2 -->
   <target name="javatest">
	<available classname="java.lang.ref.WeakReference"
	property="java2" />	
   </target>

   <!-- top-level targets  -->

   <target name="all" 
           depends="corba,names,security,events,transactions,concurrency,collections,trading" />

   <target name="services" 
           depends="events,trading,collections,transactions,concurrency"
   />


   <!-- ==================================================== -->
   <!--                       CORBA                          -->
   <!-- ==================================================== -->

   <target name="corba" 
           depends="orb,dynany,portableserver,iop,iiop,giop,conf,interceptor,compile"/>

   <target name="compile" >
	<javac srcdir="${src}/generated"
               destdir="${classdir}"
               includes="org/omg/CORBA/**/*.java,org/omg/DynamicAny/**/*.java"
        />
	<javac srcdir="${src}/generated"
               destdir="${classdir}"
               includes="org/omg/CORBA_2_3/**/*.java,org/omg/IOP/**/*.java,org/omg/GIOP/**/*.java,org/omg/IIOP/**/*.java,org/omg/CONV_FRAME/**/*.java,org/omg/Dynamic/**/*.java"
        />
	<javac srcdir="${src}/generated"
               destdir="${classdir}"
               includes="org/omg/Messaging/**/*.java,org/omg/IOP_N/**/*.java,org/omg/PortableInterceptor/**/*.java"
        />

   </target>


   <!-- standard classes defined by the IDL language mapping  -->
   <!-- are copied from a directory containing OMG-provided files -->

   <target name="orb" depends="init"> 
        <java classname="org.jacorb.idl.parser" fork="yes" classpath="${classpath}">
	      <arg line="${idlflags} ${include}/omg/_orb.idl"/>
         </java>

        <delete file="${src}/generated/org/omg/CORBA/Policy.java"/>
	<delete file="${src}/generated/org/omg/CORBA/TypeCode.java"/>
	<delete file="${src}/generated/org/omg/CORBA/TypeCodeHelper.java"/>
	<delete file="${src}/generated/org/omg/CORBA/TypeCodeHolder.java"/>
	<delete file="${src}/generated/org/omg/CORBA/TypeCodePOA.java"/>
    	<delete file="${src}/generated/org/omg/CORBA/TypeCodePOATie.java"/>
        <delete file="${src}/generated/org/omg/CORBA/_TypeCodeStub.java"/>
        <delete file="${src}/generated/org/omg/CORBA/PolicyOperations.java"/>
        <mkdir dir="${src}/generated/org"/> 

        <copy todir='${src}/generated'>
             <fileset dir="${src}/omg-99-10-27">
		        <include name="**/*.java"/>
             </fileset>
        </copy>

         <delete file="${src}/generated/org/omg/CORBA/ORB.java"/>
<!-- 	<delete file="${src}/generated/org/omg/CORBA/BadKind.java"/> -->
<!-- 	<delete file="${src}/generated/org/omg/CORBA/BadKindHelper.java"/> -->
<!--         <delete file="${src}/generated/org/omg/CORBA/BoundsHelper.java"/> -->
<!-- 	<delete file="${src}/generated/org/omg/CORBA/Bounds.java"/> -->
<!--        <delete
	file="${src}/generated/org/omg/CORBA/WrongTransaction.java"/> -->

	<copy file="${src}/java_mapping/CORBA/ORB.java"
              tofile="${src}/generated/org/omg/CORBA/ORB.java"
	/>	
	<copy file="${src}/java_mapping/CORBA/ORBPackage/InvalidNameHelper.java"
              tofile="${src}/generated/org/omg/CORBA/ORBPackage/InvalidNameHelper.java"
	/>	
	<copy file="${src}/java_mapping/CORBA/FixedHolder.java"
              tofile="${src}/generated/org/omg/CORBA/FixedHolder.java"
	/>
   </target>

   <!-- the remaining OMG classes are generated by compiling  -->
   <!-- their original IDL definitions -->

   <target name="sendingcontext" depends="init">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}  ${include}/omg/SendingContext.idl"/>
	</java>
   </target>


   <target name="iop" depends="init">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}  ${include}/omg/IOP.idl"/>
	</java>
   </target>

   <target name="iiop"  depends="init">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} ${include}/omg/IIOP.idl"/>
	</java>
   </target>

   <target name="giop" depends="init">
   <!-- Compile two times with different preprocessor flags set, so structs for -->
   <!-- both GIOP 1.0 / 1.1 and GIOP 1.2 get generated -->
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -DGIOP_1_1 ${include}/omg/GIOP.idl"/>
	</java>
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -DGIOP_1_2 ${include}/omg/GIOP.idl"/>
	</java>

   </target>

   <target name="conf">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}  -noskel ${include}/omg/CONV_FRAME.idl"/>
	</java>
   </target>
   
   <target name="interceptor" depends="time">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -nostub -noskel ${include}/omg/Dynamic.idl"/>
	</java>

	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -noskel  -nostub ${include}/omg/Messaging.idl"/>
	</java>

	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -noskel  ${include}/omg/IOP_N.idl"/>
	</java>

	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -noskel  -nostub ${include}/omg/PortableInterceptor.idl"/>
	</java>
   </target>

   <target name="portableserver" depends="init,copymapping">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
           <arg line="${idlflags} -noskel  ${include}/omg/PortableServer.idl"/>
        </java>

	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
           <arg line="${idlflags} ${include}/omg/BiDirPolicy.idl"/>
        </java>

	<javac srcdir="${src}/generated"
               destdir="${classdir}"
               includes="org/omg/PortableServer/**,org/omg/BiDirPolicy/**"
               classpath="${classpath}"
        />   
   </target>

   <!-- a few necessary classes not provided by the   -->
   <!-- language mapping, we provide these ourselves  -->

   <target name="copymapping">
	   <copy file="${src}/java_mapping/PortableServer/_ServantActivatorStub.java"
	         tofile="${src}/generated/org/omg/PortableServer/_ServantActivatorStub.java"
	   />
	   <delete file="${src}/generated/org/omg/PortableServer/Servant.java"/>
	   <copy file="${src}/java_mapping/PortableServer/Servant.java"
	         tofile="${src}/generated/org/omg/PortableServer/Servant.java"
	   />
	   <copy file="${src}/java_mapping/PortableServer/ServantActivatorPOA.java"
	         tofile="${src}/generated/org/omg/PortableServer/ServantActivatorPOA.java"
	   />
	   <copy file="${src}/java_mapping/PortableServer/ServantActivatorPOATie.java"
	         tofile="${src}/generated/org/omg/PortableServer/ServantActivatorPOATie.java"
	   />
	   <copy file="${src}/java_mapping/PortableServer/ServantLocatorPOA.java"
	         tofile="${src}/generated/org/omg/PortableServer/ServantLocatorPOA.java"
	   />
	   <copy file="${src}/java_mapping/PortableServer/ServantLocatorPOATie.java"
	         tofile="${src}/generated/org/omg/PortableServer/ServantLocatorPOATie.java"
	   />
	   <copy file="${src}/java_mapping/PortableServer/ServantLocatorHelper.java"
	         tofile="${src}/generated/org/omg/PortableServer/ServantLocatorHelper.java"
	   />
	   <copy file="${src}/java_mapping/PortableServer/_ServantLocatorStub.java"
	         tofile="${src}/generated/org/omg/PortableServer/_ServantLocatorStub.java"
	   />
	   <copy file="${src}/java_mapping/PortableServer/AdapterActivatorPOA.java"
	         tofile="${src}/generated/org/omg/PortableServer/AdapterActivatorPOA.java"
	   />
	   <copy file="${src}/java_mapping/PortableServer/AdapterActivatorPOATie.java"
	         tofile="${src}/generated/org/omg/PortableServer/AdapterActivatorPOATie.java"
	   />
   </target>

   <target name="dynany">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} ${include}/omg/DynamicAny.idl"/>
	</java>

	<javac srcdir="${src}/generated"
               destdir="${classdir}"
               includes="org/omg/DynamicAny/**"
        />
   </target>

   <!-- ==================================================== -->
   <!--                   OMG Object services                -->
   <!-- ==================================================== -->

   <!-- name service  -->

   <target name="names" depends="init">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -ir  ${include}/omg/CosNaming.idl"/>
	</java>

	<javac srcdir="${src}/generated"
               destdir="${classdir}"
               includes="org/omg/CosNaming/**/*.java,org/omg/CosNaming/*.java"          />
   </target>

   <!--               -->
   <!-- event service  -->
   <!--               -->

   <target name="events" depends="init,Comm,Admin">
	<javac srcdir="${src}/generated"
               destdir="${classdir}"
	       includes="org/omg/CosEventChannelAdmin/**,org/omg/CosEventComm/**"
         />
   </target>

   <target name="Admin">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -ir ${include}/omg/CosEventChannelAdmin.idl"/>
	</java>
   </target>

   <target name="Comm">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -ir  ${include}/omg/CosEventComm.idl"/>
	</java>
   </target>

   <!--                      -->
   <!-- transaction service  -->
   <!--                      -->

   <target name="transactions" depends="init">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}  ${include}/omg/CosTransactions.idl"/>
	</java>
	<javac srcdir="${src}/generated/"
               destdir="${classdir}" 
               includes="org/omg/CosTransactions/**/*.java,org/omg/CosTransactions/*.java"
        />
   </target>

   <!--                      -->
   <!-- collection service  -->
   <!--                      -->


   <target name="collections"  depends="init">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}   ${include}/omg/CosCollection.idl"/>
	</java>

	<javac srcdir="${src}/generated"
               destdir="${classdir}" 
	       includes="org/omg/CosCollection/Istring*.java,org/omg/CosCollection/NVPair*.java,org/omg/CosCollection/ParameterList*.java,org/omg/CosCollection/AnySequence*.java,org/omg/CosCollection/_Operations*.java,org/omg/CosCollection/Operations*.java,org/omg/CosCollection/*Invalid*.java,org/omg/CosCollection/*Reason*.java,org/omg/CosCollection/*EmptyCollection*.java,org/omg/CosCollection/*Com*.java,org/omg/CosCollection/Iterator*.java,org/omg/CosCollection/_Iterator*.java, org/omg/CosCollection/Collection*.java, org/omg/CosCollection/_Collection*.java"
	       />
	<javac srcdir="${src}/generated"
               destdir="${classdir}" 
	       includes="org/omg/CosCollection/*BoundStyle*.java,org/omg/CosCollection/*Iterator*.java,org/omg/CosCollection/_*Iterator*.java"
               excludes="org/omg/CosCollection/Iterator*.java,org/omg/CosCollection/_Iterator*.java"
	       />
	<javac srcdir="${src}/generated"
          destdir="${classdir}" 
	      includes="org/omg/CosCollection/*Operations*.java, org/omg/CosCollection/Collection*.java, org/omg/CosCollection/*Heap*.java, org/omg/CosCollection/*RestrictedAccessCollection*.java, org/omg/CosCollection/*Deque*.java, org/omg/CosCollection/*Queue*.java,org/omg/CosCollection/*Stack*.java,org/omg/CosCollection/*PriorityQueue*.java,org/omg/CosCollection/*CollectionFactor*.java, org/omg/CosCollection/*OrderedCollection*.java, org/omg/CosCollection/*SequentialCollection*.java, org/omg/CosCollection/*CSequence*.java"
		  excludes="org/omg/CosCollection/*Relation*.java, org/omg/CosCollection/*Bag*.java, org/omg/CosCollection/*EqualitySequen*.java, org/omg/CosCollection/*Map*.java,org/omg/CosCollection/*Set*.java, org/omg/CosCollection/*Key*.java"
	       />
	<javac srcdir="${src}/generated"
          destdir="${classdir}" 
	      includes="org/omg/CosCollection/*EqualitySequence*.java,org/omg/CosCollection/*Collection*.java"
		  excludes="org/omg/CosCollection/*Bag*.java, org/omg/CosCollection/*Factor*.java, org/omg/CosCollection/*Key*.java, org/omg/CosCollection/*Set*.java"
	       />
    <javac srcdir="${src}"
          destdir="${classdir}" 
	      includes="org/omg/CosCollection/*Bag*.java, org/omg/CosCollection/*Map*.java,org/omg/CosCollection/*Set*.java, org/omg/CosCollection/*Key*.java"
		  excludes="org/omg/CosCollection/*Factor*.java,org/omg/CosCollection/*Relation*.java"
	       />
    <javac srcdir="${src}/generated"
          destdir="${classdir}" 
	      includes="org/omg/CosCollection/*Factor*.java,org/omg/CosCollection/*Relation*.java"
	       />
   </target>

   <!--                      -->
   <!-- concurrency service  -->
   <!--                      -->

   <target name="concurrency">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}   ${include}/omg/CosConcurrencyControl.idl"/>
	</java>
	<javac srcdir="${src}/generated"
               destdir="${classdir}" 
               includes="org/omg/CosConcurrencyControl/**/*.java,org/omg/CosConcurrencyControl/*.java"
        />
   </target>

   <!--                      -->
   <!--     trading service  -->
   <!--                      -->

   <target name="trading" depends="init,basic,repository,dynamic">
	<javac srcdir="${src}/generated"
               destdir="${classdir}"
	       includes="org/omg/CosTrading/**,org/omg/CosTradingDynamic/**,org/omg/CosTradingRepos/**"
        />
   </target>

   <target name="basic">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}   ${include}/omg/CosTrading.idl"/>
	</java>
   </target>

   <target name="repository">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}   ${include}/omg/CosTradingRepos.idl"/>
	</java>
   </target>

   <target name="dynamic">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}   ${include}/omg/CosTradingDynamic.idl"/>
	</java>
   </target>

   <!--                           -->
   <!--     Notification service  -->
   <!--                           -->

   <target name="notification" depends="init,notif,typed">
	<javac srcdir="${src}/generated"
               destdir="${classdir}"
	       includes="org/omg/CosNotification/*.java,org/omg/CosNotify**/*.java,org/omg/CosTyped*/**/*.java"
        />
   </target>

   <target name="notif">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} ${include}/omg/CosNotification.idl ${include}/omg/CosNotifyChannelAdmin.idl"/>
	</java>
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} ${include}/omg/CosNotifyComm.idl ${include}/omg/CosNotifyFilter.idl"/>
	</java>
   </target>

   <target name="typed">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} ${include}/omg/CosTypedNotifyChannelAdmin.idl"/>
	</java>
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} ${include}/omg/CosTypedNotifyComm.idl"/>
	</java>
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} ${include}/omg/CosTypedEventChannelAdmin.idl"/>
	</java>
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} ${include}/omg/CosTypedEventComm.idl"/>
	</java>
   </target>


   <!--                      -->
   <!--    security service  -->
   <!--                      -->

   <target name="security" 
	   depends="init,time,secbasic,level1,level2,secadmin,replaceable,ssliop">
	<javac srcdir="${src}/generated"
               destdir="${classdir}"
	       includes="org/omg/TimeBase/**,org/omg/Security/**,org/omg/Security**/**,org/omg/SSLIOP/**"
        />
   </target>

   <target name="secbasic" depends="init">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -noskel -sloppy_names -nostub ${include}/omg/Security.idl"/>
	</java>
   </target>

   <target name="time" depends="init">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -noskel  -nostub ${include}/omg/TimeBase.idl"/>
	</java>
   </target>

   <target name="level1">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -sloppy_names -noskel  -nostub ${include}/omg/SecurityLevel1.idl"/>
	</java>
   </target>

   <target name="level2">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags} -sloppy_names -noskel  -nostub ${include}/omg/SecurityLevel2.idl"/>
	</java>
   </target>

   <target name="secadmin">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}  -sloppy_names -noskel  -nostub ${include}/omg/SecurityAdmin.idl"/>
	</java>
   </target>

   <target name="replaceable">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}  -sloppy_names -noskel  -nostub  ${include}/omg/SecurityReplaceable.idl"/>
	</java>
   </target>

   <target name="ssliop">
	<java classname="org.jacorb.idl.parser" classpath="${classpath}" fork="yes">
	      <arg line="${idlflags}  -sloppy_names -noskel  -nostub ${include}/omg/SSLIOP.idl"/>
	</java>
   </target>

</project>

