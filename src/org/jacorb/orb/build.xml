<?xml version="1.0"?>

<!DOCTYPE project [ <!ENTITY common SYSTEM "file:../../../../common.xml"> ]>

<project name="orb" default="all" basedir="../../../..">

  <!-- ==================================================== -->
  <!--             ORB build file                         -->
  <!-- $Id$ -->
  <!-- $Id$ -->
  <!-- ==================================================== -->

   &common;

   <target name="javatest" unless="no-rmi">
        <available classname="javax.rmi.CORBA.Stub"
                   property="rmi.iiop.present"/>
   </target>

   <target name="all" depends="init,javatest,reference-without-rmi,reference-with-rmi,compile,dns,stdInterceptors"/>

   <target name="reference-without-rmi" unless="rmi.iiop.present">
        <echo message="RMI/IIOP not present, using old Reference inheritance."/>
        <copy overwrite="yes" file="src/org/jacorb/orb/Reference.template"
              tofile="src/org/jacorb/orb/Reference.java"/>
        <replace file="src/org/jacorb/orb/Reference.java"
                 token="@EXTENDS"
                 value="org.omg.CORBA.portable.ObjectImpl"/>
   </target>

   <target name="reference-with-rmi" if="rmi.iiop.present">
        <echo message="RMI/IIOP is present, using updated Reference inheritance."/>
        <copy overwrite="yes" file="src/org/jacorb/orb/Reference.template"
              tofile="src/org/jacorb/orb/Reference.java"/>
        <replace file="src/org/jacorb/orb/Reference.java"
                 token="@EXTENDS"
                 value="javax.rmi.CORBA.Stub implements java.rmi.Remote"/>
   </target>

   <target name="compile">
      <antcall target="jacorb-javac">
         <param name="javac-includes" value="org/jacorb/orb/*.java,org/jacorb/orb/iiop/*.java,org/jacorb/orb/dii/*.java,org/jacorb/orb/dsi/*.java,org/jacorb/orb/dynany/*.java,org/jacorb/orb/policies/*.java,org/jacorb/orb/factory/*.java,org/jacorb/orb/portableInterceptor/*.java,org/jacorb/orb/connection/*.java,org/jacorb/orb/util/*.java"/>
      </antcall>
   </target>


   <target name="stdInterceptors" >
      <ant antfile="${src}/org/jacorb/orb/standardInterceptors/build.xml" dir="${basedir}"/>
   </target>


   <target name="dns" >
      <ant antfile="${src}/org/jacorb/orb/dns/build.xml" dir="${basedir}"/>
   </target>


   <target name="clean">
      <delete file="Reference.java"/>
   </target>
</project>
