<?xml version="1.0"?>

<project name="orb" default="all" basedir="../../../..">

  <!-- ==================================================== -->
  <!--             ORB build file                         -->
  <!-- $Id$ -->
  <!-- ==================================================== -->

   <target name="init" depends="javatest">
	<property name="dirs.base" value="${basedir}"/>
	<property name="classdir" value="${dirs.base}/classes"/>
	<property name="src" value="${dirs.base}/src"/>
   </target>

   <target name="javatest" unless="no-rmi">
        <available classname="javax.rmi.CORBA.Stub"
                   property="rmi.iiop.present"/>
   </target>

   <target name="all" depends="init,reference-without-rmi,reference-with-rmi,compile,dns"/> <!-- ir -->

   <target name="reference-without-rmi" unless="rmi.iiop.present">
        <echo message="RMI/IIOP not present, using old Reference inheritance."/>
        <copy overwrite="yes" file="src/org/jacorb/orb/Reference.template"
              tofile="src/org/jacorb/orb/Reference.java"/>
        <replace file="src/org/jacorb/orb/Reference.java"
                 token="@EXTENDS"
                 value="org.omg.CORBA.portable.ObjectImpl"/>
   </target>

   <target name="reference-with-rmi" if="rmi.iiop.present">
        <echo message="RMI/IIOP is present, using updated Reference inheritance."/>
        <copy overwrite="yes" file="src/org/jacorb/orb/Reference.template"
              tofile="src/org/jacorb/orb/Reference.java"/>
        <replace file="src/org/jacorb/orb/Reference.java"
                 token="@EXTENDS"
                 value="javax.rmi.CORBA.Stub implements java.rmi.Remote"/>
   </target>

   <target name="compile">
	<javac debug="${debug}" srcdir="${src}"
               destdir="${classdir}"
               bootclasspath="${dirs.base}/classes:${java.home}/lib/rt.jar"
	       includes="org/jacorb/orb/*.java,org/jacorb/orb/dii/*.java,org/jacorb/orb/dsi/*.java,org/jacorb/orb/dynany/*.java,org/jacorb/orb/policies/*.java,org/jacorb/orb/factory/*.java,org/jacorb/orb/portableInterceptor/*.java,org/jacorb/orb/standardInterceptors/*.java,org/jacorb/orb/connection/*.java,org/jacorb/orb/util/*.java"
	        />
   </target>



   <target name="domain" >
           <ant antfile="${src}/org/jacorb/orb/domain/build.xml" dir="${basedir}"/>
   </target>

   <target name="dns" >
           <ant antfile="${src}/org/jacorb/orb/dns/build.xml"
                dir="${basedir}"/>
   </target>


   <target name="clean">
      <delete file="Reference.java"/>
   </target>

   <target name="ball" depends="init">
	<javac debug="${debug}" srcdir="${src}"
               destdir="${classdir}"
	       includes="org/jacorb/orb/**/*.java,org/jacorb/orb/*.java" />
   </target>



</project>
