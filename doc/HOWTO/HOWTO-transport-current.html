<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!-- $Id$ -->

<HTML>
<HEAD>
<TITLE>Using the org.jacorb.transport.Current Feature</TITLE>

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<!--
<LINK REL="STYLESHEET" HREF="TC.css">
-->

</HEAD>

<BODY TEXT = "#000000" LINK="#000fff" VLINK="#ff0f0f" BGCOLOR="#ffffff">

<P>

<H1 ALIGN="CENTER">Using the org.jacorb.transport.Current Feature</H1>


<P ALIGN="CENTER">
Object Computing Inc.<BR>
St.Louis, Missouri
</P>

<P ALIGN="CENTER">
<SMALL><STRONG>
<A HREF="mailto:iliyan@ociweb.com">Iliyan Jeliazkov</A>
</STRONG></SMALL>
</P>

<HR>

<P>
<H3>Scope and Context</H3><P>

<P>There is no standard-mandated mechanism to facilitate obtaining
statistical or pretty much any operational information about the
network transport which the ORB is using. While this is a direct
corollary of the CORBA's design paradigm which mandates hiding all
this hairy stuff behind non-transparent abstractions, it also
precludes effective ORB and network monitoring.
</P>

<P>
The Transport::Current feature intends to fill this gap by defining a
framework for developing a wide range of solutions to this problem. It
also provides a basic implementation for the most common case - the
IIOP transport.
</P>

<P>
By definition, transport-specific information is available in contexts
where the ORB has selected a Transport:</P>

<UL>
  <LI>Within Client-side interception points;</LI>
  <LI>Within Server-side interception points;</LI>
  <LI>Inside a Servant up-call</LI>
</UL>

<P>
The implementation is based on a generic service-oriented framework,
implementing the Transport::Current interface. It is an optional
service, which can be dynamically loaded. This service makes the
Transport::Current interface available through
orb->resolve_initial_references() .

The basic idea is simple - whenever a Transport is chosen by the ORB,
the Transport::Current (or a protocolo-specific derivative) will have
access to that instance and be able to provide some useful
information.
</P>

<BR><HR>


<P>
<H3>
Programmer's Reference
</H3>

<P>
Consider the following IDL interface to access transport-specific
data.
</P>

<PRE>
module org
{

  module jacorb
  {

    module transport
    {
      /// A type used to represent counters
      typedef unsigned long long CounterT;

      // Used to signal that a call was made outside the
      // correct invocation context.

      exception NoContext
      {
      };

      // The main interface, providing access to the Transport-specific
      // information (traits), available to the current thread of
      // execution.

      local interface Current
      {
          /// Transport ID, unique within the process.
        long id() raises (NoContext);

          /// Bytes sent/received through the transport.
          CounterT bytes_sent() raises (NoContext);
          CounterT bytes_received() raises (NoContext);

          /// Messages (requests and replies) sent/received using the current
          /// protocol.
          CounterT messages_sent() raises (NoContext);
          CounterT messages_received() raises (NoContext);

          /// The absolute time (miliseconds) since the transport has been
          /// open.
          TimeBase::TimeT open_since() raises (NoContext);
      };

    };

  };

};
</PRE>

<P>
As an example of a specialized Transport::Current is the
Transport::IIOP::Current, which derives from Transport::Current and
has an interface, described in the following IDL:
</P>

<PRE>
module org
{

  module jacorb
  {

    module transport
    {
      /// A type used to represent counters
      typedef unsigned long long CounterT;

      // Used to signal that a call was made outside the
      // correct invocation context.

      exception NoContext
      {
      };

      // The main interface, providing access to the Transport-specific
      // information (traits), available to the current thread of
      // execution.

      local interface Current
      {
          /// Transport ID, unique within the process.
        long id() raises (NoContext);

          /// Bytes sent/received through the transport.
          CounterT bytes_sent() raises (NoContext);
          CounterT bytes_received() raises (NoContext);

          /// Messages (requests and replies) sent/received using the current
          /// protocol.
          CounterT messages_sent() raises (NoContext);
          CounterT messages_received() raises (NoContext);

          /// The absolute time (miliseconds) since the transport has been
          /// open.
          TimeBase::TimeT open_since() raises (NoContext);
      };

    };

  };

};

</PRE>


<P>
<H3>
User's Guide
</H3>

<P>
The org.jacorb.transport.Current can be used as a base interface for a
more specialized interfaces. Iowever, it is not requiredthat a more
specialized Current inherits from it.
</P>

<P>
Typical, generic usage is shown in the
tests/regression/src/org/jacorb/test/transport/IIOPTester.java test:
</P>


<PRE>
...
   // Get the Current object.
   Object tcobject = orb.resolve_initial_references ("JacOrbIIOPTransportCurrent");
   Current tc = CurrentHelper.narrow (tcobject);

   logger.info("TC: ["+tc.id()+"] from="+tc.local_host() +":"+tc.local_port() +", to="
                        +tc.remote_host()+":"+tc.remote_port());

   logger.info("TC: ["+tc.id()+"] sent="+tc.messages_sent ()+"("+tc.bytes_sent ()+")"
                        +", received="+tc.messages_received ()+"("+tc.bytes_received ()+")");
...
</PRE>

<P>
<H3>
Configuration, Bootstrap, Initialization and Operation
</H3>

<P>
To use the Transport Current features the framework must be loaded
through the Service Configuration framework. For example, using
something like this:
</P>


<PRE>
...
        Properties serverProps = new Properties();

        // We need the TC functionality
        serverProps.put ("org.omg.PortableInterceptor.ORBInitializerClass.server_transport_current_interceptor",
                         "org.jacorb.transport.TransportCurrentInitializer");

        serverProps.put ("org.omg.PortableInterceptor.ORBInitializerClass.server_transport_current_iiop_interceptor",
                        "org.jacorb.transport.IIOPTransportCurrentInitializer");

        serverORB = ORB.init(new String[0], serverProps);
...
</PRE>

<P>
The ORB initializer registers the "JacORbIIOPTransportCurrent" name
with the orb, so that it could be resolved via
orb->resolve_initial_references("JacORbIIOPTransportCurrent").
</P>

<P>
Note that any number of transport-specific Current interfaces may be
available at any one time.
</P>

<P>

</BODY>
</HTML>
